<!DOCTYPE html>
<html>
<head>
    <title>Homepage Migration Test Report</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 40px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        h1 { color: #2563eb; margin-bottom: 10px; }
        .subtitle { color: #64748b; margin-bottom: 30px; }
        .test-section { margin-bottom: 30px; padding: 20px; background: #f8fafc; border-radius: 6px; }
        .test-section h2 { margin-top: 0; color: #1e293b; font-size: 1.3rem; }
        .test-item { display: flex; align-items: center; margin: 10px 0; padding: 8px; }
        .test-item.pass { color: #059669; }
        .test-item.fail { color: #dc2626; background: #fee2e2; border-radius: 4px; padding: 12px; }
        .test-item.warning { color: #d97706; }
        .icon { margin-right: 10px; font-size: 18px; }
        .summary { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px; }
        .stat-card { padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 8px; text-align: center; }
        .stat-card.success { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        .stat-card.danger { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
        .stat-value { font-size: 2.5rem; font-weight: bold; margin-bottom: 5px; }
        .stat-label { font-size: 0.9rem; opacity: 0.9; }
        button { background: #2563eb; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-size: 16px; margin-right: 10px; }
        button:hover { background: #1d4ed8; }
        button.secondary { background: #64748b; }
        button.secondary:hover { background: #475569; }
        #results { margin-top: 20px; }
        .loading { display: none; text-align: center; padding: 40px; }
        .loading.active { display: block; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #2563eb; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Homepage Migration Test Report</h1>
        <p class="subtitle">Automated verification of React homepage migration</p>
        
        <div class="summary" id="summary" style="display: none;">
            <div class="stat-card success">
                <div class="stat-value" id="passCount">0</div>
                <div class="stat-label">Tests Passed</div>
            </div>
            <div class="stat-card danger">
                <div class="stat-value" id="failCount">0</div>
                <div class="stat-label">Tests Failed</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalCount">0</div>
                <div class="stat-label">Total Tests</div>
            </div>
        </div>

        <button onclick="runTests()">‚ñ∂ Run All Tests</button>
        <button class="secondary" onclick="location.href='http://kenya-directory.test'">üè† Open Homepage</button>
        <button class="secondary" onclick="openDevTools()">üîç Open in DevTools</button>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Running tests...</p>
        </div>

        <div id="results"></div>
    </div>

    <script>
        async function runTests() {
            const loading = document.getElementById('loading');
            const results = document.getElementById('results');
            const summary = document.getElementById('summary');
            
            loading.classList.add('active');
            results.innerHTML = '';
            summary.style.display = 'none';

            const tests = [
                { category: 'Server Response', tests: [
                    { name: 'Homepage returns 200 OK', test: () => checkStatus('http://kenya-directory.test') },
                    { name: 'Inertia headers present', test: () => checkInertiaHeaders('http://kenya-directory.test') },
                    { name: 'SSR bundle exists', test: () => checkFileExists('/build/ssr.js') }
                ]},
                {category: 'Assets', tests: [
                    { name: 'Main CSS loads', test: () => checkAsset('/build', 'app-', '.css') },
                    { name: 'Main JS loads', test: () => checkAsset('/build', 'app-', '.js') },
                    { name: 'Home component CSS loads', test: () => checkAsset('/build', 'Home-', '.css') },
                    { name: 'Home component JS loads', test: () => checkAsset('/build', 'Home-', '.js') }
                ]},
                { category: 'Data Loading', tests: [
                    { name: 'Hero slider data present', test: () => checkPageData('heroSliderBusinesses') },
                    { name: 'Discovery cards data present', test: () => checkPageData('discoveryCards') },
                    { name: 'Popular counties data present', test: () => checkPageData('popularCounties') }
                ]}
            ];

            let totalPass = 0;
            let totalFail = 0;
            let totalTests = 0;

            for (const section of tests) {
                const sectionDiv = document.createElement('div');
                sectionDiv.className = 'test-section';
                sectionDiv.innerHTML = `<h2>${section.category}</h2>`;

                for (const test of section.tests) {
                    totalTests++;
                    try {
                        const result = await test.test();
                        const testItem = document.createElement('div');
                        testItem.className = `test-item ${result ? 'pass' : 'fail'}`;
                        testItem.innerHTML = `
                            <span class="icon">${result ? '‚úÖ' : '‚ùå'}</span>
                            <span>${test.name}</span>
                        `;
                        sectionDiv.appendChild(testItem);
                        if (result) totalPass++; else totalFail++;
                    } catch (err) {
                        const testItem = document.createElement('div');
                        testItem.className = 'test-item fail';
                        testItem.innerHTML = `
                            <span class="icon">‚ùå</span>
                            <span>${test.name}: ${err.message}</span>
                        `;
                        sectionDiv.appendChild(testItem);
                        totalFail++;
                    }
                }

                results.appendChild(sectionDiv);
            }

            // Update summary
            document.getElementById('passCount').textContent = totalPass;
            document.getElementById('failCount').textContent = totalFail;
            document.getElementById('totalCount').textContent = totalTests;
            summary.style.display = 'grid';
            loading.classList.remove('active');
        }

        async function checkStatus(url) {
            const response = await fetch(url, { method: 'HEAD' });
            return response.ok;
        }

        async function checkInertiaHeaders(url) {
            const response = await fetch(url);
            const text = await response.text();
            return text.includes('data-page') && text.includes('inertia');
        }

        async function checkFileExists(path) {
            const response = await fetch(`http://kenya-directory.test${path}`, { method: 'HEAD' });
            return response.ok;
        }

        async function checkAsset(basePath, prefix, ext) {
            const response = await fetch('http://kenya-directory.test/build/manifest.json');
            const manifest = await response.json();
            return Object.keys(manifest).some(key => 
                key.includes(prefix) && key.endsWith(ext)
            );
        }

        async function checkPageData(prop) {
            const response = await fetch('http://kenya-directory.test');
            const html = await response.text();
            const match = html.match(/data-page="([^"]+)"/);
            if (!match) return false;
            const pageData = JSON.parse(match[1].replace(/&quot;/g, '"'));
            return pageData.props && pageData.props[prop] !== undefined;
        }

        function openDevTools() {
            window.open('http://kenya-directory.test', '_blank');
            alert('Open DevTools (F12) in the new window and check the Console tab for errors');
        }
    </script>
</body>
</html>
